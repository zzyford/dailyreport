# 智能日报系统 - Web版

一个基于Flask的智能日报管理系统，支持Markdown编辑、邮件自动收集、AI智能汇总等功能。

## 🌟 功能特色

### 📝 智能编辑器
- **Markdown编辑器**：支持完整的Markdown语法，包括表格、列表、代码块等
- **实时预览**：点击预览按钮即可查看渲染后的效果
- **模板插入**：提供工作、会议、项目、表格等快速模板
- **实时统计**：自动统计字数和行数
- **智能光标**：模板插入后自动定位光标位置

### 📧 邮件集成
- **自动收集**：自动从企业邮箱收集团队日报
- **智能过滤**：根据发件人和主题关键词筛选相关邮件
- **多人支持**：支持收集多个同事的日报邮件
- **日期筛选**：可指定日期收集对应日期的邮件

### 🤖 AI智能汇总
- **内容合并**：将个人工作内容与团队邮件日报智能合并
- **AI分析**：使用阿里云百炼AI进行内容分析和汇总
- **结构化输出**：生成结构清晰、逻辑合理的综合日报
- **一键生成**：点击生成按钮即可完成整个汇总流程

### 💾 数据管理
- **SQLite存储**：所有数据本地存储，安全可靠
- **历史记录**：自动保存每次生成的日报，支持历史查看
- **内容备份**：用户输入内容自动保存，防止数据丢失
- **版本管理**：支持同一日期多次编辑和保存

### 🎨 用户界面
- **响应式设计**：适配桌面端和移动端
- **现代化UI**：基于Bootstrap 5，界面美观易用
- **快捷操作**：右侧面板提供快速操作和统计信息
- **通知系统**：实时通知操作结果，用户体验友好

## 📦 安装部署

### 环境要求
- Python 3.8+
- Flask 3.0+
- SQLite 3

### 安装步骤

1. **克隆项目**
```bash
git clone <项目地址>
cd dailyreport
```

2. **安装依赖**
```bash
pip install -r requirements.txt
```

3. **配置环境变量**
复制 `.env.example` 为 `.env` 并配置：
```bash
cp .env.example .env
```

编辑 `.env` 文件：
```env
# 邮箱配置
EMAIL_ADDRESS=your-email@sunfield.mobi
EMAIL_PASSWORD=your-password
IMAP_SERVER=imap.sunfield.mobi
IMAP_PORT=993
SMTP_SERVER=smtp.sunfield.mobi
SMTP_PORT=465

# AI配置
DASHSCOPE_API_KEY=your-api-key
DASHSCOPE_APP_ID=your-app-id

# 日报收集配置
TARGET_SENDERS=sender1@domain.com,sender2@domain.com
SUBJECT_KEYWORDS=日报
```

4. **启动应用**
```bash
python web_app.py
```

5. **访问系统**
打开浏览器访问：http://localhost:5000

## 🚀 使用指南

### 基本使用流程

1. **编写工作内容**
   - 在左侧编辑区域输入您的工作内容
   - 支持完整的Markdown语法
   - 可使用右侧快速模板

2. **保存内容**
   - 点击"保存内容"按钮保存到数据库
   - 系统会自动按日期管理您的内容

3. **生成日报**
   - 点击"生成日报"按钮
   - 系统会自动：
     - 收集团队邮件日报
     - 合并您的个人内容
     - 使用AI进行智能汇总
     - 生成最终日报

4. **查看结果**
   - 在弹出窗口中查看生成的日报
   - 可复制到剪贴板
   - 自动保存到历史记录

### 高级功能

#### 模板使用
右侧提供四种常用模板：

- **工作模板**：包含已完成、进行中、计划明日的标准结构
- **会议模板**：会议记录的标准格式
- **表格模板**：数据统计表格，可自定义内容
- **项目模板**：项目进展报告格式

#### 预览功能
- 点击"预览"按钮实时查看Markdown渲染效果
- 确保格式正确后再生成日报

#### 历史记录
- 访问"历史记录"页面查看所有生成的日报
- 支持按日期筛选和内容搜索
- 可复制历史日报内容

## 📋 Markdown语法支持

系统支持完整的Markdown语法：

### 基础格式
```markdown
**粗体文本**
*斜体文本*
`代码`
~~删除线~~
```

### 标题
```markdown
# 一级标题
## 二级标题
### 三级标题
```

### 列表
```markdown
- 无序列表项1
- 无序列表项2

1. 有序列表项1
2. 有序列表项2

- [ ] 待办事项1
- [x] 已完成事项
```

### 表格
```markdown
| 项目 | 一季度 | 二季度 | 三季度 | 四季度 | Total |
|------|--------|--------|--------|--------|-------|
| 产能 | 952,539.54 | 1,472,238.24 | 548,348.15 |  |  |
| 发票 |  |  |  |  |  |
```

### 代码块
```markdown
```python
def hello_world():
    print("Hello, World!")
```
```

### 引用
```markdown
> 这是一个引用文本
> 可以多行显示
```

## 🔧 系统配置

### 邮箱配置说明

系统支持IMAP和SMTP协议，需要配置以下参数：

- `EMAIL_ADDRESS`：您的邮箱地址
- `EMAIL_PASSWORD`：邮箱密码或应用专用密码
- `IMAP_SERVER`：IMAP服务器地址
- `IMAP_PORT`：IMAP端口（通常为993）
- `SMTP_SERVER`：SMTP服务器地址
- `SMTP_PORT`：SMTP端口（通常为465）

### AI配置说明

使用阿里云百炼平台提供AI服务：

- `DASHSCOPE_API_KEY`：API密钥
- `DASHSCOPE_APP_ID`：应用ID

### 日报收集配置

- `TARGET_SENDERS`：目标发件人邮箱列表，用逗号分隔
- `SUBJECT_KEYWORDS`：邮件主题关键词，用于筛选日报邮件

## 📊 数据库结构

系统使用SQLite数据库，包含以下表：

### user_content 表
存储用户输入的工作内容：
- `id`：主键
- `date`：日期
- `content`：内容
- `created_at`：创建时间
- `updated_at`：更新时间

### generated_reports 表
存储生成的日报：
- `id`：主键
- `date`：日期
- `user_content`：用户内容
- `email_content`：邮件内容
- `final_report`：最终日报
- `created_at`：创建时间

## 🚨 故障排除

### 常见问题

1. **邮箱连接失败**
   - 检查邮箱服务器配置是否正确
   - 确认邮箱密码是否正确
   - 某些邮箱需要开启"第三方应用授权"

2. **AI生成失败**
   - 检查API密钥是否正确
   - 确认网络连接正常
   - 查看API配额是否充足

3. **页面样式异常**
   - 检查static文件是否完整
   - 确认CSS/JS文件路径正确
   - 清除浏览器缓存

4. **数据库错误**
   - 检查文件权限
   - 确认SQLite数据库可写
   - 查看日志文件获取详细错误信息

### 日志查看

系统运行时会输出详细日志，包括：
- 邮件收集过程
- AI汇总过程  
- 数据库操作
- 错误信息

## 🔐 安全说明

- 所有数据本地存储，不上传到外部服务器
- 邮箱密码等敏感信息存储在.env文件中
- 建议定期备份数据库文件
- 生产环境建议使用HTTPS

## 📝 更新日志

### v1.0.0 (2025-06-23)
- ✨ 初始版本发布
- 📝 Markdown编辑器
- 📧 邮件自动收集
- 🤖 AI智能汇总
- 💾 SQLite数据存储
- 🎨 响应式Web界面

## 📞 技术支持

如果您在使用过程中遇到问题，请：

1. 查看本文档的故障排除部分
2. 检查系统日志获取详细错误信息
3. 确认配置文件是否正确

## 📄 许可证

本项目基于 MIT 许可证发布。 